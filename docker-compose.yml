services:
  # ==========================================
  # Ambiente de Desenvolvimento
  # Uso: docker-compose up app-dev
  # Acesse: http://localhost:5173
  # ==========================================
  app-dev:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: eventos-cafe-dev
    ports:
      - '5173:5173'
    volumes:
      - .:/app
      - /app/node_modules
    env_file:
      - .env
    environment:
      - CHOKIDAR_USEPOLLING=true
    stdin_open: true
    tty: true
    networks:
      - eventos-network
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 1G
        reservations:
          cpus: '0.25'
          memory: 256M

  # ==========================================
  # Ambiente de Staging (Validação pré-produção)
  # Uso: docker-compose --profile staging up app-staging
  # Acesse: http://localhost:3000
  # ==========================================
  app-staging:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        VITE_SUPABASE_URL: ${VITE_SUPABASE_URL}
        VITE_SUPABASE_ANON_KEY: ${VITE_SUPABASE_ANON_KEY}
    container_name: eventos-cafe-staging
    ports:
      - '3000:80'
    networks:
      - eventos-network
    profiles:
      - staging
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 256M
        reservations:
          cpus: '0.1'
          memory: 64M

  # ==========================================
  # Ambiente de Produção
  # Uso: docker-compose --profile production up app-prod
  # Acesse: http://localhost
  # ==========================================
  app-prod:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        VITE_SUPABASE_URL: ${VITE_SUPABASE_URL}
        VITE_SUPABASE_ANON_KEY: ${VITE_SUPABASE_ANON_KEY}
    container_name: eventos-cafe-prod
    ports:
      - '80:80'
    networks:
      - eventos-network
    profiles:
      - production
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 128M

networks:
  eventos-network:
    driver: bridge
